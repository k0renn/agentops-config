allowed_paths:
  - app/**
  - components/**
  - providers/**
  - hooks/**
  - lib/**
  - convex/**
  - middleware.ts
  - package.json
  - package-lock.json
  - tsconfig.json
  - tailwind.config.ts
  - postcss.config.js
  - .eslintrc.json
  - components.json
  - README.md
audit:
  architecture_derivation:
    canonical_service_type_evidence_paths:
      - .claude/CLAUDE.md
      - .cursor/rules.md
      - .github/copilot-instructions.md
canonical_service_type:
  chosen: Backend-for-Frontend (BFF)
enforcement:
  - 'All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent. (evidence: convex/users.ts, convex/groups.ts, convex/posts.ts)'
  - 'Inbound webhook route /stripe must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes. (evidence: convex/http.ts, convex/stripe.ts)'
  - 'Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review. (evidence: middleware.ts)'
  - 'Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api). (evidence: convex/schema.ts, app/(homepage)/page.tsx)'
  - 'Convex boundary: mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity(). (evidence: convex/posts.ts, convex/comments.ts)'
  - 'Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing. (evidence: convex/http.ts)'
  - 'Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions. (evidence: convex/stripe.ts, app/create/page.tsx)'
  - 'Dependency boundary: new dependencies must be justified; keep lockfile updated and committed. (evidence: package.json, package-lock.json)'
forbidden_responsibilities:
  - evidence_paths:
      - middleware.ts
      - convex/auth.config.ts
    responsibility: Owning identity provider implementation (user auth, MFA, session issuance)
    title: Owning identity provider implementation (user auth, MFA, session issuance)
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
    responsibility: Owning authentication credentials (password storage, credential verification, custom session token minting)
    title: Owning authentication credentials (password storage, credential verification, custom session token minting)
  - evidence_paths:
      - convex/stripe.ts
      - convex/http.ts
    responsibility: Owning payment processor / card vault (PCI storage/processing)
    title: Owning payment processor / card vault (PCI storage/processing)
  - evidence_paths:
      - convex/schema.ts
      - convex/_generated
    responsibility: Operating a standalone database or database server administration outside Convex
    title: Operating a standalone database or database server administration outside Convex
hard_prohibitions:
  - 'Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk. (evidence: middleware.ts, convex/auth.config.ts)'
  - 'Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET). (evidence: convex/stripe.ts)'
  - 'Do not bypass Stripe webhook signature verification for subscription fulfillment. (evidence: convex/stripe.ts, convex/http.ts)'
  - 'Do not implement direct database server management; data persistence is via Convex tables/schema only. (evidence: convex/schema.ts)'
  - 'Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk. (evidence: convex/auth.config.ts, middleware.ts)'
  - 'Do not process or store raw payment card data; payments remain delegated to Stripe. (evidence: convex/stripe.ts)'
  - 'Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables. (evidence: convex/schema.ts)'
  - 'Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity(). (evidence: convex/users.ts, convex/posts.ts, convex/groups.ts)'
  - 'Do not accept external webhooks without signature verification and strict parsing/bounds. (evidence: convex/http.ts, convex/stripe.ts)'
owned_responsibilities:
  - evidence_paths:
      - app/layout.tsx
      - app/(homepage)/page.tsx
      - app/[groupId]/page.tsx
    responsibility: Next.js application routing, layouts, and UI rendering (App Router)
    title: Next.js application routing, layouts, and UI rendering (App Router)
  - evidence_paths:
      - convex/schema.ts
      - convex/posts.ts
      - convex/groups.ts
    responsibility: Backend data model and business operations via Convex queries/mutations (domain persistence)
    title: Backend data model and business operations via Convex queries/mutations (domain persistence)
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
      - convex/auth.config.ts
    responsibility: Authentication integration and route protection using Clerk
    title: Authentication integration and route protection using Clerk
  - evidence_paths:
      - convex/stripe.ts
      - convex/http.ts
      - app/create/page.tsx
    responsibility: Subscription checkout initiation and Stripe webhook fulfillment handling
    title: Subscription checkout initiation and Stripe webhook fulfillment handling
  - evidence_paths:
      - hooks/use-api-mutation.ts
      - app/(homepage)/page.tsx
      - app/[groupId]/page.tsx
    responsibility: BFF data access orchestration via Convex client hooks (queries/mutations/actions)
    title: BFF data access orchestration via Convex client hooks (queries/mutations/actions)
  - evidence_paths:
      - convex/users.ts
      - convex/groups.ts
      - convex/comments.ts
    responsibility: Identity-aware access checks at backend boundary using Convex auth context
    title: Identity-aware access checks at backend boundary using Convex auth context
service:
  id: k0renn/AcademiX
  slug: academix
  source_of_truth: DATA.repoScan
team:
  base_policy: org-defaults
  name: AcademiX team
team_guidelines:
  cicd:
    - Run lint via next lint (extends next/core-web-vitals).
    - Ensure TypeScript compile/typecheck passes under strict mode (tsconfig.json, convex/tsconfig.json).
    - Keep Node runtime compatibility aligned with repo requirement (Node 14.x per README.md).
    - 'Before merging: ensure Next.js build succeeds and Convex functions typecheck.'
    - If GitHub Actions workflows are added, keep them minimal, deterministic, and aligned with org defaults.
  dependencies:
    - Use Convex React bindings (convex/react) and generated API imports (@/convex/_generated/api).
    - Use Clerk Next.js SDK for auth and route protection (@clerk/nextjs, middleware.ts).
    - Use Stripe SDK only in server-side Convex actions that require secrets (process.env.NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).
    - UI primitives should prefer Radix + shadcn patterns already present in components/ui/*.
    - Do not add a second auth provider; authentication remains delegated to Clerk.
    - Do not add a second persistence layer; persistence remains in Convex tables/schema unless explicitly approved.
  general:
    - 'Repository-first governance: implement only what the existing codebase indicates is needed; missing logic is prohibited.'
    - 'Use Next.js App Router conventions: app/ for routes/layouts, components/ for shared UI, convex/ for backend functions.'
    - Treat Convex functions as the backend boundary; UI calls generated Convex APIs (@/convex/_generated/api).
    - Keep business/data mutations in convex/; UI should invoke mutations/actions and focus on presentation.
    - Prefer server-side enforcement for access control; client-side checks are UX only.
  naming_formatting:
    - 'React components: PascalCase exports; filenames typically kebab-case or lowercase under components/.'
    - 'Convex functions: export const <name> = query|mutation|action(...) with clear verb naming (list/create/update/remove/add).'
    - 'TypeScript strict mode: keep types explicit at boundaries (Convex Id/Doc types).'
    - Keep route segments under app/ aligned with Next.js App Router conventions.
  security:
    - All authenticated operations in convex/ must check ctx.auth.getUserIdentity() before accessing user-scoped data.
    - Never trust client-provided user identifiers; use Convex indexes (e.g., users.by_token, users.by_email).
    - Stripe webhooks must validate stripe-signature and STRIPE_WEBHOOK_SECRET before mutating state.
    - Do not widen public routes in middleware without explicit review; default is protect-all.
    - Never commit secrets; use environment variables only.
additional_context: "---\nFILE: .claude/CLAUDE.md\n---\n# Service Contract — k0renn/AcademiX\n\nYou are working inside a **strictly-scoped backend service**.\n\nTeam: AcademiX team\nBase policy: org-defaults\n\nCanonical service type: **Backend-for-Frontend (BFF)**  \nSource of truth: DATA.repoScan\n\n---\n\n## ✅ Owned Responsibilities\n\nYou MAY implement or modify code ONLY for the following responsibilities:\n\n### ✔ Next.js application routing, layouts, and UI rendering (App Router)\nEvidence:\n\n### ✔ Backend data model and business operations via Convex queries/mutations (domain persistence)\nEvidence:\n\n### ✔ Authentication integration and route protection using Clerk\nEvidence:\n\n### ✔ Subscription checkout initiation and Stripe webhook fulfillment handling\nEvidence:\n\n### ✔ BFF data access orchestration via Convex client hooks (queries/mutations/actions)\nEvidence:\n\n### ✔ Identity-aware access checks at backend boundary using Convex auth context\nEvidence:\n\n---\n\n## ❌ Forbidden Responsibilities\n\nYou MUST NOT introduce code related to the following responsibilities.\nIf asked to do so — **refuse explicitly and explain why**, citing evidence.\n\n### ✖ Owning identity provider implementation (user auth, MFA, session issuance)\nEvidence:\n\n### ✖ Owning authentication credentials (password storage, credential verification, custom session token minting)\nEvidence:\n\n### ✖ Owning payment processor / card vault (PCI storage/processing)\nEvidence:\n\n### ✖ Operating a standalone database or database server administration outside Convex\nEvidence:\n\n---\n\n## \U0001F4C2 Allowed Paths\n\nAll changes MUST be limited to the following paths:\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n---\n\n## ⛔ Hard Prohibitions (Non-Negotiable)\n- Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- Do not process or store raw payment card data; payments remain delegated to Stripe.\n- Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- Do not accept external webhooks without signature verification and strict parsing/bounds.\n- Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk. (evidence: middleware.ts, convex/auth.config.ts)\n- Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET). (evidence: convex/stripe.ts)\n- Do not bypass Stripe webhook signature verification for subscription fulfillment. (evidence: convex/stripe.ts, convex/http.ts)\n- Do not implement direct database server management; data persistence is via Convex tables/schema only. (evidence: convex/schema.ts)\n- Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk. (evidence: convex/auth.config.ts, middleware.ts)\n- Do not process or store raw payment card data; payments remain delegated to Stripe. (evidence: convex/stripe.ts)\n- Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables. (evidence: convex/schema.ts)\n- Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity(). (evidence: convex/users.ts, convex/posts.ts, convex/groups.ts)\n- Do not accept external webhooks without signature verification and strict parsing/bounds. (evidence: convex/http.ts, convex/stripe.ts)\n\n---\n\n## \U0001F6E1 Enforcement Rules\n- All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n- All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent. (evidence: convex/users.ts, convex/groups.ts, convex/posts.ts)\n- Inbound webhook route /stripe must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes. (evidence: convex/http.ts, convex/stripe.ts)\n- Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review. (evidence: middleware.ts)\n- Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api). (evidence: convex/schema.ts, app/(homepage)/page.tsx)\n- Convex boundary: mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity(). (evidence: convex/posts.ts, convex/comments.ts)\n- Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing. (evidence: convex/http.ts)\n- Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions. (evidence: convex/stripe.ts, app/create/page.tsx)\n- Dependency boundary: new dependencies must be justified; keep lockfile updated and committed. (evidence: package.json, package-lock.json)\n\n---\n\n## \U0001F465 Team Coding Guidelines\n\n### General\n- Follow repository-first governance: implement only what the existing codebase indicates is needed; missing logic is prohibited.\n- Use Next.js App Router conventions: app/ for routes/layouts, components/ for shared UI, convex/ for backend functions.\n- Treat Convex functions as the backend boundary; UI calls generated Convex APIs (api.*) rather than duplicating data logic.\n- Keep business/data mutations in convex/; UI should only invoke mutations/actions and handle presentation.\n- Prefer server-side enforcement for access control; client-side checks are UX only.\n- Repository-first governance: implement only what existing code indicates is needed; missing logic is prohibited. (evidence: .claude/CLAUDE.md, .cursor/rules.md)\n- Use Next.js App Router conventions: app/ for routes/layouts, components/ for shared UI, convex/ for backend functions. (evidence: app/layout.tsx, convex/README.md)\n- Treat Convex functions as the backend boundary; UI calls generated Convex APIs (api.*) rather than duplicating data logic. (evidence: app/(homepage)/page.tsx, convex/*)\n- Keep business/data mutations in convex/; UI should invoke mutations/actions and handle presentation. (evidence: convex/posts.ts, app/[groupId]/page.tsx)\n- Prefer server-side enforcement for access control; client-side checks are UX only. (evidence: convex/users.ts, middleware.ts)\n\n### Naming & Formatting\n- React components: PascalCase exports; filenames typically kebab-case or lowercase under components/.\n- Convex functions: export const <name> = query|mutation|action(...) with clear verb naming (list/create/update/remove/add).\n- TypeScript strict mode: keep types explicit at boundaries (Convex Id/Doc types).\n- Keep route segments under app/ aligned with Next.js App Router conventions.\n- React components: PascalCase exports; filenames typically kebab-case or lowercase under components/. (evidence: components/about-side.tsx, components/navbar/select-modal.tsx)\n- Convex functions: export const <name> = query|mutation|action(...) with clear verb naming. (evidence: convex/posts.ts, convex/groups.ts)\n- TypeScript strict mode: keep types explicit at boundaries (Convex Id/Doc types). (evidence: tsconfig.json, app/[groupId]/page.tsx)\n- Keep route segments under app/ aligned with Next.js App Router conventions. (evidence: app/(homepage)/page.tsx, app/[groupId]/page.tsx)\n\n### Dependencies\n- Use Convex React bindings (convex/react) and generated API imports (@/convex/_generated/api).\n- Use Clerk Next.js SDK for auth and route protection (@clerk/nextjs, middleware.ts).\n- Use Stripe SDK only in server-side Convex actions that require secrets (process.env.NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- UI primitives should prefer Radix + shadcn patterns already present in components/ui/*.\n- Do not add a second auth provider; authentication remains delegated to Clerk.\n- Do not add a second persistence layer; persistence remains in Convex tables/schema unless explicitly approved.\n- Use Convex React bindings and generated API imports (@/convex/_generated/api). (evidence: app/(homepage)/page.tsx, hooks/use-api-mutation.ts)\n- Use Clerk Next.js SDK for auth and route protection. (evidence: middleware.ts, providers/convex-client-provider.tsx)\n- Use Stripe SDK only in server-side Convex actions that require secrets. (evidence: convex/stripe.ts)\n- UI primitives should prefer Radix + shadcn patterns already present in components/ui/*. (evidence: components/ui/button.tsx, components/ui/avatar.tsx)\n- Do not add a second auth provider; authentication remains delegated to Clerk. (evidence: convex/auth.config.ts, middleware.ts)\n- Do not add a second persistence layer; persistence remains in Convex tables/schema unless explicitly approved. (evidence: convex/schema.ts)\n\n### Security\n- All authenticated operations in convex/ must check ctx.auth.getUserIdentity() before accessing user-scoped data.\n- Never trust client-provided user identifiers; use Convex indexes (e.g., users.by_token, users.by_email).\n- Stripe webhooks must validate stripe-signature and STRIPE_WEBHOOK_SECRET before mutating state.\n- Do not widen public routes in middleware without explicit review; default is protect-all.\n- Never commit secrets; use environment variables only.\n- All authenticated operations in convex/ must check ctx.auth.getUserIdentity() before accessing user-scoped data. (evidence: convex/users.ts, convex/groups.ts)\n- Never trust client-provided user identifiers; use Convex indexes (e.g., users.by_token, users.by_email). (evidence: convex/users.ts, convex/schema.ts)\n- Stripe webhooks must validate stripe-signature and STRIPE_WEBHOOK_SECRET before mutating state. (evidence: convex/http.ts, convex/stripe.ts)\n- Do not widen public routes in middleware without explicit review; default is protect-all. (evidence: middleware.ts)\n- Never commit secrets; use environment variables only. (evidence: convex/stripe.ts)\n\n### CI/CD & Repo Hygiene\n- Run lint via next lint (extends next/core-web-vitals).\n- Ensure TypeScript compile/typecheck passes under strict mode (tsconfig.json, convex/tsconfig.json).\n- Keep Node runtime compatibility aligned with repo requirement (Node 14.x per README.md).\n- Before merging: ensure Next.js build succeeds and Convex functions typecheck.\n- If GitHub Actions workflows are added, require checks to pass before merge.\n- Run lint via next lint (extends next/core-web-vitals). (evidence: package.json, .eslintrc.json)\n- Ensure TypeScript compile/typecheck passes under strict mode for app and convex. (evidence: tsconfig.json, convex/tsconfig.json)\n- Keep Node runtime compatibility aligned with repo requirement (Node 14.x). (evidence: README.md)\n- Before merging: ensure Next.js build succeeds and Convex functions typecheck. (evidence: package.json, convex/tsconfig.json)\n- If GitHub Actions workflows are added, require checks to pass before merge. (context: DATA.teamContextData.communicationAnalysis.channels)\n\n---\n\n## Final Rule\n\nIf a request:\n- Exceeds the service scope\n- Violates team guidelines\n- Introduces forbidden responsibilities\n\n**Refuse clearly, explain briefly, and cite evidence paths.**\n\n---\nFILE: .cursor/rules.md\n---\n# Cursor Rules — k0renn/AcademiX\n\n## Operating Constraints (Read First)\n- MUST align changes with the **Owned Responsibilities** below.\n- MUST NOT implement anything in **Forbidden Responsibilities**.\n- MUST obey **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## Architecture (Source of Truth)\n- Source of truth: DATA.repoScan\n\n## Canonical Service Type (Choose Exactly One)\n- **Backend-for-Frontend (BFF)**\n\n## Owned Responsibilities (Allowed)\n1. Next.js application routing, layouts, and UI rendering (App Router)\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n1. Authentication integration and route protection using Clerk\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n1. Identity-aware access checks at backend boundary using Convex auth context\n\n## Forbidden Responsibilities (Prohibited)\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n1. Owning payment processor / card vault (PCI storage/processing)\n1. Operating a standalone database or database server administration outside Convex\n\n## Enforcement (Mandatory)\n- MUST: All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent.\n- MUST: Inbound webhook route /stripe must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes.\n- MUST: Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review.\n- MUST: Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- MUST: Convex boundary: mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- MUST: Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- MUST: Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- MUST: Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n## Allowed Paths (Strict)\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions (Non-Negotiable)\n- MUST NOT: Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- MUST NOT: Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- MUST NOT: Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- MUST NOT: Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- MUST NOT: Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- MUST NOT: Do not process or store raw payment card data; payments remain delegated to Stripe.\n- MUST NOT: Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- MUST NOT: Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- MUST NOT: Do not accept external webhooks without signature verification and strict parsing/bounds.\n\n---\nFILE: .github/copilot-instructions.md\n---\n# GitHub Copilot Instructions — k0renn/AcademiX\n\n## Scope\n- Source of truth: DATA.repoScan\n- Service type: **Backend-for-Frontend (BFF)**\n\n## MUST\n- Follow the **Owned Responsibilities** list.\n- Follow **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## MUST NOT\n- Implement anything listed under **Forbidden Responsibilities**.\n\n## Owned Responsibilities (Allowed)\n1. Next.js application routing, layouts, and UI rendering (App Router)\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n1. Authentication integration and route protection using Clerk\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n1. Identity-aware access checks at backend boundary using Convex auth context\n\n## Forbidden Responsibilities (Prohibited)\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n1. Owning payment processor / card vault (PCI storage/processing)\n1. Operating a standalone database or database server administration outside Convex\n\n## Enforcement (Mandatory)\n- All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n## Allowed Paths\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions\n- Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- Do not process or store raw payment card data; payments remain delegated to Stripe.\n- Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- Do not accept external webhooks without signature verification and strict parsing/bounds.\n\n---\nFILE: .windsurf/rules.md\n---\n# Windsurf Rules — k0renn/AcademiX\n\n## Quick Guardrails\n- Follow **Allowed Responsibilities**.\n- Refuse changes that add **Forbidden Responsibilities**.\n- Follow **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## Architecture\n- Source of truth: DATA.repoScan\n\n## Canonical Service Type (Exactly One)\n- **Backend-for-Frontend (BFF)**\n\n## Owned Responsibilities (Allowed)\nOnly these responsibilities may be implemented/extended in this repo.\n1. Next.js application routing, layouts, and UI rendering (App Router)\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n1. Authentication integration and route protection using Clerk\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n1. Identity-aware access checks at backend boundary using Convex auth context\n\n## Forbidden Responsibilities (Prohibited)\nRefuse changes that add code for any of these responsibilities.\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n1. Owning payment processor / card vault (PCI storage/processing)\n1. Operating a standalone database or database server administration outside Convex\n\n## Enforcement (Mandatory)\n- MUST: All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- MUST: Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- MUST: Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- MUST: Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- MUST: Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- MUST: Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- MUST: Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- MUST: Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n- MUST: All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent. (evidence: convex/users.ts, convex/groups.ts, convex/posts.ts)\n- MUST: Inbound webhook route /stripe must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes. (evidence: convex/http.ts, convex/stripe.ts)\n- MUST: Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review. (evidence: middleware.ts)\n- MUST: Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api). (evidence: convex/schema.ts, app/(homepage)/page.tsx)\n- MUST: Convex boundary: mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity(). (evidence: convex/posts.ts, convex/comments.ts)\n- MUST: Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing. (evidence: convex/http.ts)\n- MUST: Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions. (evidence: convex/stripe.ts, app/create/page.tsx)\n- MUST: Dependency boundary: new dependencies must be justified; keep lockfile updated and committed. (evidence: package.json, package-lock.json)\n\n## Allowed Paths (Strict)\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions (Non-Negotiable)\n- MUST NOT: Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- MUST NOT: Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- MUST NOT: Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- MUST NOT: Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- MUST NOT: Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- MUST NOT: Do not process or store raw payment card data; payments remain delegated to Stripe.\n- MUST NOT: Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- MUST NOT: Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- MUST NOT: Do not accept external webhooks without signature verification and strict parsing/bounds.\n- MUST NOT: Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk. (evidence: middleware.ts, convex/auth.config.ts)\n- MUST NOT: Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET). (evidence: convex/stripe.ts)\n- MUST NOT: Do not bypass Stripe webhook signature verification for subscription fulfillment. (evidence: convex/stripe.ts, convex/http.ts)\n- MUST NOT: Do not implement direct database server management; data persistence is via Convex tables/schema only. (evidence: convex/schema.ts)\n- MUST NOT: Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk. (evidence: convex/auth.config.ts, middleware.ts)\n- MUST NOT: Do not process or store raw payment card data; payments remain delegated to Stripe. (evidence: convex/stripe.ts)\n- MUST NOT: Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables. (evidence: convex/schema.ts)\n- MUST NOT: Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity(). (evidence: convex/users.ts, convex/posts.ts, convex/groups.ts)\n- MUST NOT: Do not accept external webhooks without signature verification and strict parsing/bounds. (evidence: convex/http.ts, convex/stripe.ts)"
agentops_metadata:
  doc_assets:
    pdf: 0
    doc: 0
    text: 6
  doc_assets_note: This project includes documentation assets in the repo (pdf=0, doc/docx=0, text=6). Consider them when relevant.
